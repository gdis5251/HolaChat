# HolaChat

## 项目简介：

用 socket 编程来做的一个聊天程序，实现多台主机可同时发送对话给任意一方。

- 期间使用了多线程来保证客户端可以在任意时刻都能接收到消息，保证了TCP服务器可以对多个客户端进行同时连接。
- 使用线程同步来控制显示顺序。

## 环境

- 编程语言：C++
- 开发平台：Linux CentOS 7.0
- 开发工具：vim 代码编辑器，gcc 编译器，makefile 工程管理工具，gdb 调试器

## TCP 版本

因为 UDP 版本比较简单，这里只说一下 TCP 版本。

### 封装 socket 函数

**tcp_socket.hpp**

这个文件里，将所有的 TCP 会使用到的 socket 函数封装起来，注释都比较清楚。

### 封装服务器，可有利于做一个通用的服务器程序，以后不管什么服务器都可以在这个基础上去制作。只需微微调整即可。

**tcp_thread_server.hpp**

- 这里使用了多线程，因为在 accept 之后会产生新的文件描述符，使用多线程可以让每个连接都是一个新的执行流，而主线程只负责接收连接即可。
- 增加了 Epoll 版本处理连接。

### 封装客户端，为了屏蔽掉客户端不需要的接口，大大降低用户的学习成本。

**tcp_client.hpp**

这里没啥说的，就只是把客户端需要的接口暴露出来，不需要的接口屏蔽起来。

### 服务器端程序

因为上一层服务器的封装，所以这里只需要写一个计算请求的函数即可。

- 我把所有新连接进来的客户端输入的用户名和产生的新文件描述符记录在一个 map 里面。
- 然后根据客户端发来的请求类型，分类处理。

### 客户端程序

- 建立连接时输入用户名，把用户名直接发给服务器，让服务器记录。

- 发送消息是，需要先获取正在连接的用户，然后通过输入用户名和编辑发送消息的方式，发送给服务器，让服务器处理该把消息发给谁。

- 退出时，把当前用户的用户名发给服务器，让服务器完成删除当前用户的信息操作。